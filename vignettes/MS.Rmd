---
title: "streamFind: Back-end for Mass Spectrometry"
output: 
  bookdown::html_document2:
    toc: yes
    toc_float: yes
    theme: paper
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{streamFind: Back-end for Mass Spectrometry}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE,
  fig.align = "center",
  fig.width = 9,
  cache = TRUE
)
```

```{r libraries, include=FALSE}
library(knitr)
library(kableExtra)
library(magrittr)
library(ggplot2)
library(plotly)
```

# Introduction

The streamFind R package is a tool focusing on data processing for environmental and quality studies. The streamFind aims to stimulate the use of advanced data analysis (e.g., non-target screening, statistical analysis, etc.) in routine studies, promoting standardization of data processing and structure and easing the retrospective evaluation of data. The streamFind is open-source and can be used by academics but also by technicians due to the comprehensive documentation and well categorized set of integrated functions or modules. This vignette introduces the basic framework of the streamFind back-end for processing of mass spectrometric (MS) data. The streamFind R package is loaded as shown below.

```{r setup}
library(streamFind)
```

# Resources

## MS files

The streamFind R package includes example data files via the [streamFindData](https://github.com/ricardobachertdacunha/streamFindData)  R package. Once streamFindData is installed, the full file paths of example MS data files can be obtained as shown below. The files available are described in the Table \@ref(tab:description-files). Note, the MS files (.mzML) were trimmed with the function `trim_ms_files_spectra()` from streamFind to reduce their size. The centroided Agilent Q-TOF files were trimmed with retention time between 900 and 1350 seconds, *m/z* for MS1 data between 200 and 450 Da and *m/z* for MS2 between 35 and 450 Da. Additionally, MS1 and MS2 traces below 100 and 50 counts were removed, respectively. The profile Agilent Q-TOF files were trimmed with retention time between 1000 and 1200 seconds, *m/z* for MS1 data between 200 and 300 Da and *m/z* for MS2 between 35 and 300 Da. Additionally, MS1 and MS2 traces below 1 count were removed to exclude empty spectra. The files are used within the document for demonstration of the back-end.

```{r resource-files, cache=FALSE}
files <- streamFindData::msFilePaths()
```

<br>

```{r description-files, echo=FALSE}
df_files_desc <- streamFindData::msFilesDescription()

knitr::kable(df_files_desc, caption = "Files included in the streamFind R package.") %>%
  column_spec(column = 3, width = "100px") %>%
  column_spec(column = 4, width = "60px") %>%
  kable_styling(font_size = 11.5, bootstrap_options = c("striped", "hover", "responsive"), fixed_thead = TRUE) %>%
  scroll_box(width = "100%", height = "600px")
```

## Spiked chemicals

The chemicals spiked in the MS files are described below in Table \@ref(tab:show-table-chemicals). The internal standards (IS) are spiked to all Agilent Q-TOF files. The chemical standards (S) were only spiked for the first 6 Agilent Q-TOF files. Note that not all IS and S are visible in the profile Agilent Q-TOF files as a narrower trimming was applied.

```{r load-table-chemicals}
db <- streamFindData::msSpikedChemicals()
```

```{r show-table-chemicals, echo=FALSE}
knitr::kable(db[, .(name, CAS, formula, mass, rt, ionization, tag, in_file)], caption = "Chemical standards spiked.") %>%
  kable_styling(font_size = 11, bootstrap_options = c("striped", "hover", "responsive"), fixed_thead = TRUE) %>%
  scroll_box(width = "100%", height = "600px")
```

# msData

The msData is an [R6 class](https://r6.r-lib.org/articles/Introduction.html) object, holding the MS data parsed from *.mzML* or *.mzXML* files as well as the methods to get, visualize and process the parsed data (see `?msData` for detailed documentation). The most straight forward manner to initiate an msData object is with a character vector of *.mzML* or *.mzXML* file full path/s, as shown below for three MS files (triplicate, 1 to 3 in \@ref(tab:description-files)). The object name was defined to *Example 1* using the argument *header*. For more information on the `msData$new()` method, see `?msData` documentation.

```{r new-ms-object-call, message=FALSE, results='hide', message=FALSE, warning=FALSE}
ms <- msData$new(files = files[1:3], header = list(name = "Example 1"))
```

The `print` (or `show`) method is shown below by running the msData object name. A list of the included analyses is printed to the console matching the files added.

```{r print-method}
ms
```

## Data fields

The msData object contains the following internal fields (or private fields) to store user defined and parsed data: **header**, **settings**, **analyses**, **groups** and **alignment**. The internal fields cannot be directly accessed nor changed. Instead, the user must use the respective get and add methods, as shown in the sections \@ref(get-methods) and \@ref(add-methods), respectively.  

- The **header** is a list of entries with length 1 (e.g., name, path, date, etc.) that characterize the msData object. When not given, name, path and date are automatically generated and included in the list as they are required for workflow purposes.
- The **settings** is a named `list` of objects used for data processing. Each added object is named according to the function call (or processing name). The settings interface is described in section \@ref(processing-settings).
- The **analyses** is a named `list` of object representing each file added to the msData. The name of the object is the name of the file. No duplicate file names can exist in the msData. The structure of each object in analyses is shown in section \@ref(analyses). 
- The **groups** is a `data.table` with the feature groups after correspondence analysis (i.e., grouping of features across analyses).
- The **alignment** is a `list` with the results of the retention time alignment for each analyses in the msData object.

```{r}




```


## Get methods


## Add methods



# Analyses



# Processing settings



















<style>

body, p {
  color: black;
  font-family: Arial;
  text-align: justify;
  font-size: 12pt;
}

h1 {
  font-size: 20pt;
  font-style: bold;
}

h2 {
  font-size:18pt;
  font-style: bold;
}

h3 {
  font-size:14pt;
  font-style: bold;
}

.list-group-item.active, 
.list-group-item.active:focus, 
.list-group-item.active:hover {
  background-color: #239B56;
}

caption {
  color: black;
  font-size: 1.0em;
}

</style>
